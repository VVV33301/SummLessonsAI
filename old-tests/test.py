'''
input_file = 'videoplayback.mp4'
AUDIO = 'output.wav'

if not os.path.exists(AUDIO) or True:
    call(f'ffmpeg -i {input_file} -y -b:a 16k -vn {AUDIO}')

# Загружаем аудио с помощью librosa
waveform, sample_rate = librosa.load(AUDIO, sr=16000)

# Загружаем Wav2Vec 2.0 для распознавания речи
tokenizer = Wav2Vec2Tokenizer.from_pretrained("UrukHan/wav2vec2-russian")
model = Wav2Vec2ForCTC.from_pretrained("UrukHan/wav2vec2-russian")

# Преобразуем аудио в input_values для модели
input_values = tokenizer(waveform, return_tensors="pt", padding="longest").input_values

# Распознаем текст
with torch.no_grad():
    logits = model(input_values).logits

# Получаем результат
predicted_ids = torch.argmax(logits, dim=-1)
transcription = tokenizer.decode(predicted_ids[0])

print("Распознанный текст: ", transcription)

# Теперь используем модель суммаризации на основе BERT (например, BART)
summarizer = pipeline("summarization", model="facebook/bart-large-cnn")

# Составляем краткое содержание
summary = summarizer(transcription[:1024], max_length=300, min_length=30, do_sample=False)

print("Краткое содержание: ", summary[0]['summary_text'])

'''


import os

os.environ["TRANSFORMERS_CACHE"] = "E:/SFgroup/transformers_cache"

import torch
import librosa
from transformers import Wav2Vec2ForCTC, Wav2Vec2Processor, pipeline
from moviepy.editor import VideoFileClip


def extract_audio(video_url):
    clip = VideoFileClip(video_url)
    audio_path = "extracted_audio.wav"
    clip.audio.write_audiofile(audio_path)
    return audio_path


def audio_to_text_wav2vec(audio_path):
    # Загрузка модели и процессора
    processor = Wav2Vec2Processor.from_pretrained("jonatasgrosman/wav2vec2-large-xlsr-53-russian")
    model = Wav2Vec2ForCTC.from_pretrained("jonatasgrosman/wav2vec2-large-xlsr-53-russian")

    # Загрузка аудио с использованием librosa
    speech, _ = librosa.load(audio_path, sr=16000)  # 16kHz — это частота, ожидаемая моделью
    input_values = processor(speech, return_tensors="pt", padding="longest").input_values

    # Получение логитов (результат модели до применения функции softmax)
    with torch.no_grad():
        logits = model(input_values).logits

    # Получение предсказаний
    predicted_ids = torch.argmax(logits, dim=-1)

    # Преобразование предсказанных ID в текст
    transcription = processor.decode(predicted_ids[0])

    print(transcription)
    return transcription


def summarize_text(text):
    summarizer = pipeline("summarization", model="facebook/bart-large-cnn")  # Пример для русского языка
    summary = summarizer(text, max_new_tokens=500, min_length=30, do_sample=False)
    return summary[0]['summary_text']


def video_to_summary():
    # Извлечение аудио из видео
    # audio_path = extract_audio(video_url)
    audio_path = '../output.wav'

    # Преобразование аудио в текст с использованием Wav2Vec 2.0
    # text = audio_to_text_wav2vec(audio_path)
    text = 'если бы я мог по мня только однувещего реметого покдае к сеуче со программировать тоэто небыла босныеные закоьли же просмото других тоторилов по которомие бучлс это определенно но все двеся продсомтов былабы смено потходокобучению ивсего образомышления касательно программирование в принципа всем преткого не видал в этомвиде распожевом прото тракможное змися пототко бычени программированию чтобы непросто учтязыки технологи развивать правильным ышления которое и тличает паным программиста поговоримо том почему пракяконо ноговожнетьго и кактредолеватьсвоо яега и чтозначит преукать кем добством если ты хочешь стает на пустановлене понастояче качетым программистом евпервого очи трафессионалом тоствася доконциа будет многополезных инсаетов причем нетольто моих ны ногие домих людей ноходячися в профессе же непервы го и так первое практика должна перевешивать сеори всеонынекослышали правле десяти тыся яко бы чтобы тать ровессеоналом каком-либоделе требуются удвитим деся тысяч часов тодаш нявозпринималоть ислатрмирно так нужно прочтать ее болше к ник посмотреть еще больше бочащих виде лучить еще больше языков и тогдали всеэтом протяжение десят тысяч часов и чем бы сря это сдлатьям бы среостано более просяинальном программисста тейчаже мое филосоввеодинаноличается то что былантотмомент озчитанно примерно так нужно писать кажт проекто и каждого срококодо лучше чемделото даэтого чутмтиратнецида программировани  это впервочит наво который можно и нужно развивать чем боже же бы то сделашь тем полшено бешше  и тм быстро и качетменног чися новым программирование больше подит нанекрудном закоальном инструменте илежересованя скольк угодно ведосов непересмотринуты ненаучишьчся брать борые по касаое того непопробы ты можешь хоть на протяжении деся ти тысяч часов смотреть нато каправильное ресатоготи похпоено токото самние отпрошие стратор и своими руками неначешегоресовать у тебя этого неполучио бучение всегда должно быть завяз напрактике и отягивания того момента когда то быключишь очереныгает на технологи икся и начнемжунокоинстать кор приведетсябя тольпколишь кочм эффктивном своеинформации никачественному обучению вбщето то иточен звазано теме того как правильно бучатся программированию в целом поэтому есл этотведосно бро кото тодачу черестоментариелаке то я сразубросяду готовать материалнаэто тему гордость  это твй брак никто никогданехочто понятся тивною спучном работу брестатья тичном усранитьсялижепасять однитеже данны я веть программис первую чт нетолько интересно прды задачи подава я хоче бысат свое конны тобылитлеграма сделаться уседется спользующий искуственные ителект я нехоще работо слегсеко дом баами ожибка когда тебя посечат подобное мысли знай в тебе говорить твое о если неборотсо ся и неотказыватся такою позици тото не сможешь неработать комаде небыд полезным неэффективно бучаться развиваься подобное мысли будут появляться ва тебя всегда меня самоодо поспотонеся колетоработовоте не посещают и я всяче кистараетеными боротся когдополучается тоделать моярбытоспособность пом шается в раз получается излячи стаких моментов много ползя а еще ме токанедурно кочатся втом пункте можно подместя еще дного немаловажно вещь непризвося к своему коду пото то вперочить просто кот ктонибы бругой или даже ты сам ся рнораноелипознопоменяещиг ткото то вфемерное понятьям стоит все месегоми защаеть сего и бро бослевное натехкто посмел посе нытном то высвящено угралия смеился у редачетепревыкаятнее удобством копрограммиссто не обязаны быть ходячися клопеди изнатя бсолютном со овоздач как программисты заключается невыдачи ответа позапросу и даже ненаписании кода торабото за плючается б успешном решения бизно задач и бысто дотаться кокружащем условиям тебе всегда может прдете ногое задачевыходящи затстоя илиже просто чтото ногое чемтодя этого несталки что чем этоздаче с покойному же быть описеннонаоченмвысоком урования без технических подробности и это супернеудот бынаше воле то мы всегда быделати толькоточему же сталкиватт  и это нормальные бе наш мост устроин так чтотогдамостакивамся чем-то новом непонятом это всегдастро и если непосавить подобныемусмылено контроль то мы не нарочнобудем всемиселыми збегать примого свопновение стакими сотуация но будучи программисно тебе следует понять привыкать к томучо то постоянном будеть сталкиватся чем о ногом понятном и неудобно если ты чего-то не знаешь и не моженомметальне решить задачу тоэто незначит чтотыплохо прорммист похо програмисст пто тоткто нехоче выходить и совезонокомфорта тоткото неготовтменять я незнаи я не могудето сделаться на я изучим разберусять а максимальное эффективное развитие кокмызданто сходит именно тогдакогдолюди воходито онно комфр и это непросо словачередного влопозымторнета нокочисленно иследные потверждают это например человеком ксимально прокачиваться когдопережает ро быстрануо там де нас всеновые непривычные постоянно приходится выходит изоно комфорто по тему ачение закат зведениеногог знаконствия эдоптации вцелом хороше же програмимеряется изучает не удобном задачив технологию что только лишь добавляетомы вспротить я повторусь меня я немогу но  я изучу просто подходи к непонятом задачем подругому кпом-то смысле это должно приносить себе удовольствия так хорошо я не должено бояться чего-то нового сейчас изучу чтво токласные станлучже чеми был до выполнение то задач та  какой же вывод можно сделать повсему что ноговорил ты никогда не сможешь гочеся прораммировани о всех навечков есть извечно вопроса какое зыключить первом каоколичесто времени выделять на обучения такие курсы проходить что обще лучше в прон татоли поканта ското быстро вылучить за икся язык а что сейчас актуально анепрограли итьно поз му затяоло  а конечно вкопком-тосмысле все этяво просоколректны и имет право на существования нони даже можно отлечать завесимостятконтекста но задаваю подобног просовы также упускается всесутспрограммирование деновичков тебе не нужно совершенствовалодевать изаками направлениями в начале своего пути то должен прате проботься здать свои приложения припомощи зка остоянного недря изучаего фишки изабеблятияк илефромвортка  это в первую уить инструменты кгда отебя задаче забить босто доженого читься именно процессов бивания гвоздесь втен любодругой предмет чтобы приэто неотбитьсебе пальси и нерасхираче с тем очем то будеь то делать молоткомо-любошкой людей изучающи хруб этоже простепенного роскокоренемереаоптияшеерешения таким же образом тебе не нужно полность заучивать понимать различное концепции закаини трегих инструмент тобазо уроане тотак пытаещи их понять покочтаж допоментасию к игулесмтречто тори опосле то идешедазаразыванидряйщихсопроекто слес чегото все лучшие лучшеначначпонимать для чего немужны как их использова роскажу напримере допустом тоделтько пото проетт погаету исталкиваеся скотосамимиструментоми которогызывают утпо некотрые трудности наример уремодели и запросы что-то захочешь сделать ставишь веденно паузу и начинаеж добавлять вм кцонал ко себе в код тебя начна отполаеткоттоошибкти солмается не работы ты нам стопом гублит считаеть что ти форумы чтобы решить воникшу проем а даже сли посокопопасу тебе всею работы то ты не задумываюшься а каконом работ и утебя со всем ничего неткатывться в додани но и ты я понимаем что н завтошние утрого тебастаентся в лучшим стлучи процом водваться тет все то информации ч то побучи какже сделатправилено так рукей я не понимае чтотольпкочто сделатчел но эзакончлобиче киразела то тоделолегает и после пододелать ман ки проекта связанно ся этим том ционалом скорее всего то сразуможе возразить укей как токими том поменае дуработу исо невлатею всеми приемыми инструментыми концепциами на нужном вакансеуровани и тот снова упускаешь суть гда тебя берутно позицию интрныели женат тебя и неожидают что ты нахорое уроне буде лодет нужными инструментами а тебя не ожидается что ты будеть они батого чтоэтебяожидается такэто знание пределенное частельстека на которую компанятебе нанимаетстажем промто-тразработкан реакти о что еще важнее едаже датся терпения настойчивоть постоянном убучении и готовность итовать все новые новое вещь и это то как становится по насточем пласным програмисста они очень хоршо знат понимает баци мы не за щеттовочточитатном бык николисмото тогромное количесто туторило о зачет тучасозданных проектов и большого стремляние вочачо то ного ричем насвоем собцвенном опыть они зарываются в эго они стремяться выти зоносего комфорта потому чтохотято бычитьс чем то новому и их постоянное бучени перрастает в неприживное постижение мыстерства программирования'

    # Генерация краткого содержания с помощью BERT
    summary = summarize_text(text)

    print(summary)
    return summary


print(video_to_summary())